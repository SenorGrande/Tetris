language: python
python:
- '3.6'
branches:
  only: master
warnings_are_errors: false
install:
- pip install awscli
- pip install aws-sam-cli
script:
- sam build -b highscore-service -t highscore-service/template.yamls
- sam package --template-file .aws-sam/build/template.yaml --s3-bucket highscore-service --output-template-file highscore-service/packaged.yaml
- bash build.sh
deploy:
  - provider: script
    script: sam deploy --template-file highscore-service/packaged.yaml --capabilities CAPABILITY_IAM --stack-name travis-serverless-test
    skip_cleanup: true
#   notifications:
#     email:
#       on_failure: always
  - provider: s3
    access_key_id: $AWS_ACCESS_KEY_ID
    secret_access_key: $AWS_SECRET_ACCESS_KEY
    bucket: "tetris-frontend"
    skip_cleanup: true
    region: $AWS_DEFAULT_REGION
    local_dir: frontend/react-tetris/build
  
env:
  global:
  - AWS_DEFAULT_REGION=ap-southeast-2
  - AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY
  - AWS_SECRET_ACCESS_KEY=$AWS_SECRET_KEY
